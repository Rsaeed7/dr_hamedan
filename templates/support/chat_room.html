{% extends "base.html" %}
{% load static %}
{% block content %}
<div class="container mx-auto p-4">
    <h1 class="text-3xl font-bold mb-6 text-center text-blue-700">💬 چت پشتیبانی دکتر همدان</h1>

    <div id="chat-messages"
         class="space-y-4 mb-6 h-[28rem] overflow-y-auto p-4 bg-gray-50 rounded-lg shadow-inner border border-gray-200">
        {% for message in messages %}
        <div class="flex {% if message.sender.is_staff %}justify-end{% else %}justify-start{% endif %}">
            <div class="max-w-md rounded-xl p-3 shadow
                        {% if message.sender.is_staff %}bg-green-100 text-right{% else %}bg-blue-100 text-left{% endif %}">
                <div class="font-semibold text-sm
                            {% if message.sender.is_staff %}text-green-800{% else %}text-blue-800{% endif %}">
                    {{ message.sender.username }}
                </div>
                <p class="mt-1 text-gray-800 break-words">{{ message.content }}</p>
                <div class="text-xs mt-1 text-gray-400">
                    {{ message.created_at|date:"Y/m/d H:i" }}
                </div>
            </div>
        </div>
        {% empty %}
        <p class="text-center text-gray-400">هیچ پیامی وجود ندارد.</p>
        {% endfor %}
    </div>

    <form id="message-form"
          method="post"
          action="{% url 'support:send_message' chat_room.id %}"
          class="mt-4">
        {% csrf_token %}
        <div class="flex items-center gap-2 m-b-60">
            <input
                type="text"
                name="content"
                placeholder="پیام خود را بنویسید..."
                class="flex-grow p-3 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500"
                autocomplete="off"
            />
            <button type="submit"
                    class="bg-blue-600 hover:bg-blue-700 text-white p-3 rounded-full w-12 h-12 flex items-center justify-center transition-colors duration-200">
                <svg xmlns="http://www.w3.org/2000/svg"
                     class="h-5 w-5"
                     viewBox="0 0 20 20"
                     fill="currentColor">
                    <path fill-rule="evenodd"
                          d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-8.707l-3-3a1 1 0 00-1.414 1.414L10.586 9H7a1 1 0 100 2h3.586l-1.293 1.293a1 1 0 101.414 1.414l3-3a1 1 0 000-1.414z"
                          clip-rule="evenodd" />
                </svg>
            </button>
        </div>
    </form>
</div>

{% endblock %}

{% block extra_js %}
<!-- انتقال roomId به JavaScript -->
{{ chat_room.id|json_script:"room-id" }}

<!-- لینک به فایل JS جداگانه -->
<script src="{% static 'js/chat/admin-chat.js' %}"></script>
{% endblock %}

