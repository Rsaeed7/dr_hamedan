{% extends 'base.html' %}

{% block title %}داشبورد - دکتر {% endblock %}

{% block extra_css %}
<style>
    /* Base Styles */
    body {
        direction: rtl;
        text-align: right;
        font-family: 'Vazir', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    /* Layout */
    .appointments-container {
        display: flex;
        flex-direction: column;
        min-height: calc(100vh - 4rem);
    }

    @media (min-width: 768px) {
        .appointments-container {
            flex-direction: row;
        }
    }

    .main-content {
        flex: 1;
        padding: 1.5rem;
        background-color: #f9fafb;
    }

    /* Cards */
    .appointment-card {
        transition: all 0.3s ease;
        border-radius: 0.75rem;
        margin-bottom: 1rem;
        background-color: white;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .appointment-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    }

    /* Patient Info */
    .patient-avatar {
        width: 3rem;
        height: 3rem;
        border-radius: 50%;
        object-fit: cover;
    }

    .patient-initials {
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: #e5e7eb;
        color: #4b5563;
        font-weight: bold;
    }

    /* Status Badges */
    .status-badge {
        display: inline-flex;
        align-items: center;
        padding: 0.25rem 0.75rem;
        border-radius: 9999px;
        font-size: 0.75rem;
        font-weight: 500;
    }

    .status-pending {
        background-color: #fef3c7;
        color: #92400e;
    }

    .status-confirmed {
        background-color: #dbeafe;
        color: #1e40af;
    }

    .status-completed {
        background-color: #d1fae5;
        color: #065f46;
    }

    .status-cancelled {
        background-color: #fee2e2;
        color: #991b1b;
    }

    /* Buttons */
    .btn {
        padding: 0.5rem 1rem;
        border-radius: 0.375rem;
        font-size: 0.875rem;
        font-weight: 500;
        transition: all 0.2s;
    }

    .btn-confirm {
        background-color: #2563eb;
        color: white;
    }

    .btn-confirm:hover {
        background-color: #1d4ed8;
    }

    .btn-complete {
        background-color: #059669;
        color: white;
    }

    .btn-complete:hover {
        background-color: #047857;
    }

    .btn-cancel {
        background-color: #dc2626;
        color: white;
    }

    .btn-cancel:hover {
        background-color: #b91c1c;
    }

    .btn-view {
        background-color: #4b5563;
        color: white;
    }

    .btn-view:hover {
        background-color: #374151;
    }

    /* Filter Section */
    .filter-section {
        background-color: white;
        border-radius: 0.75rem;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        margin-bottom: 1.5rem;
    }

    .filter-grid {
        display: grid;
        gap: 1rem;
    }

    @media (min-width: 640px) {
        .filter-grid {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    @media (min-width: 1024px) {
        .filter-grid {
            grid-template-columns: repeat(4, 1fr);
        }
    }

    /* Empty State */
    .empty-state {
        text-align: center;
        padding: 2rem;
    }

    .empty-state-icon {
        width: 3rem;
        height: 3rem;
        margin: 0 auto 1rem;
        color: #9ca3af;
    }

    /* Responsive Adjustments */
    @media (max-width: 767px) {
        .patient-info {
            flex-direction: column;
            align-items: flex-start;
        }

        .appointment-actions {
            flex-direction: column;
            gap: 0.5rem;
        }

        .action-buttons {
            width: 100%;
        }

        .btn {
            width: 100%;
            text-align: center;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="bg-gradiant min-h-screen rtl">
    <div class="flex flex-col md:flex-row">
        <!-- Sidebar -->
        <div class="w-full md:w-64 sidebar shadow-sm">
            <div class="p-4">
                <!-- Doctor Profile Card -->
                <a href="{% url 'doctors:doctor_profile' %}" class="block">
                    <div class="profile-card p-4 text-white">
                        <div class="flex items-center">
                            {% if doctor.profile_image %}
                                <img src="{{ doctor.profile_image.url }}" alt="{{ doctor }}"
                                     class="w-12 h-12 round50 object-cover ml-3">
                            {% else %}
                                <div class="w-12 h-12 round50 bg-white bg-opacity-20 flex items-center justify-center ml-3">
                                    <span class="text-white text-lg font-bold">{{ doctor.user.first_name|first }}{{ doctor.user.last_name|first }}</span>
                                </div>
                            {% endif %}
                            <div>
                                <h2 class="font-bold">دکتر {{ doctor.user.last_name }}</h2>
                                <p class="text-white text-opacity-80 text-xs">{{ doctor.specialization }}</p>
                            </div>
                        </div>
                    </div>
                </a>

                <!-- Navigation Links -->
                <div class="mt-4 space-y-2">
                    <a href="{% url 'doctors:doctor_availability' %}" class="nav-item flex items-center px-3 py-2 text-secondary hover:text_dr">
                        <div class="w-7 h-7 bg-blue-50 rounded-5 flex items-center justify-center ml-2">
                            <i class="icon-clock-3 text-sm text_dr"></i>
                        </div>
                        <span>مدیریت زمان‌ها</span>
                    </a>

                    <a href="{% url 'doctors:doctor_appointments' %}" class="nav-item flex items-center px-3 py-2 text-secondary hover:text-success">
                        <div class="w-7 h-7 bg-green-50 rounded-5 flex items-center justify-center ml-2">
                            <i class="icon-user-md text-sm text-success"></i>
                        </div>
                        <span>نوبت‌ها</span>
                    </a>

                    <a href="{% url 'doctors:doctor_earnings' %}" class="nav-item flex items-center px-3 py-2 text-secondary hover:text-warning">
                        <div class="w-7 h-7 bg-yellow-50 rounded-5 flex items-center justify-center ml-2">
                            <i class="icon-money-2 text-sm text-warning"></i>
                        </div>
                        <span>درآمد</span>
                    </a>

                    <a href="{% url 'docpages:doctor_posts' %}" class="nav-item flex items-center px-3 py-2 text-secondary hover:text-info">
                        <div class="w-7 h-7 bg-purple-50 rounded-5 flex items-center justify-center ml-2">
                            <i class="icon-edit text-sm text_dr_3"></i>
                        </div>
                        <span>پست‌های من</span>
                    </a>

                    <a href="{% url 'doctors:inbox' %}" class="nav-item flex items-center px-3 py-2 text-secondary hover:text_dr">
                        <div class="w-7 h-7 bg-indigo-50 rounded-5 flex items-center justify-center ml-2">
                            <i class="icon-mail text-sm text-info"></i>
                        </div>
                        <span>نامه ها</span>
                    </a>

                    <a href="{% url 'doctors:notifications' %}" class="nav-item flex items-center px-3 py-2 text-secondary hover:text_dr">
                        <div class="w-7 h-7 bg-red-50 rounded-5 flex items-center justify-center ml-2">
                            <i class="icon-bell text-sm text-danger"></i>
                            {% if unread_notifications_count > 0 %}
                                <span class="absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-xs rounded-full flex items-center justify-center">
                                    {{ unread_notifications_count }}
                                </span>
                            {% endif %}
                        </div>
                        <span>اعلان‌ها</span>
                    </a>

                    <a href="{% url 'patients:report_list' %}" class="nav-item flex items-center px-3 py-2 text-secondary hover:text-warning">
                        <div class="w-7 h-7 bg-yellow-50 rounded-5 flex items-center justify-center ml-2">
                            <i class="icon-doc text-sm text-warning"></i>
                        </div>
                        <span>گزارش‌ها</span>
                    </a>

                    <a href="{% url 'doctors:doctor_profile' %}" class="nav-item flex items-center px-3 py-2 text-secondary hover:text_info">
                        <div class="w-7 h-7 bg-blue-50 rounded-5 flex items-center justify-center ml-2">
                            <i class="icon-user text-sm text-info"></i>
                        </div>
                        <span>پروفایل</span>
                    </a>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="flex-1 p-6">
            <!-- Welcome Header -->
            <div class="bg-white rounded-20 shadow-sm p-6 margin_30_20">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center">
                    <div>
                        <h1 class="text-2xl font-bold text_dr">
                            سلام دکتر {{ doctor.user.last_name }} 👋
                        </h1>
                        <p class="text-secondary text-sm mt-1">{{ today|date:"l، Y/m/d" }}</p>

                        <div class="mt-4 flex flex-wrap items-center gap-4">
                            <div class="flex items-center bg-gray-50 rounded-10 px-4 py-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text_dr ml-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                </svg>
                                <span class="text-sm">{{ today_appointments }} نوبت امروز</span>
                            </div>

                            <a href="{% url 'doctors:doctor_availability' %}" class="text-sm text_dr flex items-center hover:underline">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                                </svg>
                                تنظیم نوبت‌دهی
                            </a>
                        </div>
                    </div>

                    {% if doctor.profile_image %}
                        <img src="{{ doctor.profile_image.url }}" alt="{{ doctor }}"
                             class="rounded-full mt-4 md:mt-0 w-20 h-20 object-cover">
                    {% else %}
                        <div class="rounded-full bg-blue-100 flex items-center justify-center mt-4 md:mt-0 w-20 h-20">
                            <span class="text-blue-600 font-bold text-xl">
                                {{ doctor.user.first_name|first }}{{ doctor.user.last_name|first }}
                            </span>
                        </div>
                    {% endif %}
                </div>
            </div>

            <!-- Stats Cards -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 margin_30_20">
                <!-- Total Appointments -->
                <div class="stat-card p-4">
                    <div class="flex items-center justify-between">
                        <div class="w-10 h-10 bg-blue-50 rounded-10 flex items-center justify-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text_dr" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                            </svg>
                        </div>
                        <div class="text-left">
                            <div class="text-xl font-bold text_dr">{{ total_appointments }}</div>
                            <div class="text-xs text-secondary">کل نوبت‌ها</div>
                        </div>
                    </div>
                </div>

                <!-- Pending Appointments -->
                <div class="stat-card p-4">
                    <div class="flex items-center justify-between">
                        <div class="w-10 h-10 bg-yellow-50 rounded-10 flex items-center justify-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-warning" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                        </div>
                        <div class="text-left">
                            <div class="text-xl font-bold text-warning">{{ pending_appointments }}</div>
                            <div class="text-xs text-secondary">در انتظار</div>
                        </div>
                    </div>
                </div>

                <!-- Today's Appointments -->
                <div class="stat-card p-4">
                    <div class="flex items-center justify-between">
                        <div class="w-10 h-10 bg-green-50 rounded-10 flex items-center justify-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-success" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                        </div>
                        <div class="text-left">
                            <div class="text-xl font-bold text-success">{{ today_appointments }}</div>
                            <div class="text-xs text-secondary">نوبت امروز</div>
                        </div>
                    </div>
                </div>

                <!-- Monthly Earnings -->
                <div class="stat-card p-4">
                    <div class="flex items-center justify-between">
                        <div class="w-10 h-10 bg-purple-50 rounded-10 flex items-center justify-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text_dr_3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                        </div>
                        <div class="text-left">
                            <div class="text-md font-bold text_dr_3">{{ current_month_earnings|default:"0" }}</div>
                            <div class="text-xs text-secondary">درآمد ماه جاری</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Notifications -->
            <div class="bg-white rounded-20 shadow-sm p-6 margin_30_20">
                <div class="flex justify-between items-center mb-6">
                    <div>
                        <h2 class="text-xl font-bold text_dr mb-1">اعلان‌های اخیر</h2>
                        <p class="text-secondary text-sm">آخرین بروزرسانی‌ها</p>
                    </div>
                    <div class="flex items-center space-x-3">
                        {% if unread_notifications_count > 0 %}
                            <button onclick="markAllNotificationsRead()" class="text-sm text_dr hover:underline">
                                علامت‌گذاری همه
                            </button>
                        {% endif %}
                        <a href="{% url 'doctors:notifications' %}" class="text-sm text_dr hover:underline">
                            مشاهده همه
                        </a>
                    </div>
                </div>

                {% if recent_notifications %}
                    <div class="space-y-3" id="notifications-container">
                        {% for notification in recent_notifications %}
                            <div class="notification-item p-4 rounded-10 border border-gray-100 hover:bg-gray-50 transition-colors {% if not notification.is_read %}bg-blue-50{% endif %}"
                                 data-notification-id="{{ notification.id }}">
                                <div class="flex items-start">
                                    <div class="w-10 h-10 rounded-10 flex items-center justify-center ml-3
                                                {% if notification.notification_type == 'success' %}bg-green-100 text-success
                                                {% elif notification.notification_type == 'warning' %}bg-yellow-100 text-warning
                                                {% elif notification.notification_type == 'error' %}bg-red-100 text-danger
                                                {% elif notification.notification_type == 'appointment' %}bg-blue-100 text_dr
                                                {% elif notification.notification_type == 'message' %}bg-purple-100 text_dr_3
                                                {% else %}bg-gray-100 text-secondary{% endif %}">
                                        <i class="fas {{ notification.get_type_icon }} text-sm"></i>
                                    </div>
                                    <div class="flex-1">
                                        <div class="flex justify-between items-start mb-2">
                                            <h3 class="font-bold text_dr text-sm">{{ notification.title }}</h3>
                                            <div class="flex items-center space-x-2">
                                                {% if not notification.is_read %}
                                                    <span class="w-2 h-2 bg-blue-500 rounded-full"></span>
                                                {% endif %}
                                                <span class="text-xs text-gray-400">{{ notification.created_at|timesince }} پیش</span>
                                            </div>
                                        </div>
                                        <p class="text-secondary text-sm mb-2">{{ notification.message|truncatewords:20 }}</p>
                                        <div class="flex items-center justify-between">
                                            {% if notification.link %}
                                                <a href="{{ notification.link }}" class="text-xs text_dr hover:underline">
                                                    مشاهده جزئیات
                                                </a>
                                            {% else %}
                                                <span></span>
                                            {% endif %}
                                            <div class="flex items-center space-x-2">
                                                {% if not notification.is_read %}
                                                    <button onclick="markNotificationRead({{ notification.id }})"
                                                            class="text-xs text_dr hover:underline">
                                                        خوانده شده
                                                    </button>
                                                {% endif %}
                                                <button onclick="deleteNotification({{ notification.id }})"
                                                        class="text-xs text-red-500 hover:underline">
                                                    حذف
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="text-center py-8 bg-gray-50 rounded-10">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 mx-auto mb-3 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 17h5l-5 5-5-5h5v-5a7.5 7.5 0 01-7.5-7.5"/>
                        </svg>
                        <h3 class="text-lg font-bold text_dr mb-1">اعلان جدیدی ندارید</h3>
                        <p class="text-secondary text-sm">اعلان‌های جدید در اینجا نمایش داده خواهند شد</p>
                    </div>
                {% endif %}
            </div>

            <!-- Today's Appointments List -->
            <div class="bg-white rounded-20 shadow-sm p-6 margin_30_20">
                <div class="flex justify-between items-center mb-6">
                    <div>
                        <h2 class="text-xl font-bold text_dr mb-1">نوبت‌های امروز</h2>
                        <p class="text-secondary text-sm">{{ today|date:"l، Y/m/d" }}</p>
                    </div>
                    <a href="{% url 'doctors:doctor_appointments' %}" class="text-sm text_dr hover:underline">
                        مشاهده همه
                    </a>
                </div>

                {% if today_appointments_list %}
                    <div class="space-y-3">
                        {% for appointment in today_appointments_list %}
                            <div class="appointment-card p-4 flex justify-between items-center">
                                <div class="flex items-center">
                                    {% if appointment.patient.profile_image %}
                                        <img src="{{ appointment.patient.profile_image.url }}"
                                             alt="{{ appointment.patient }}"
                                             class="w-12 h-12 round50 object-cover ml-3 border border-gray-100">
                                    {% else %}
                                        <div class="w-12 h-12 round50 bg-blue-100 flex items-center justify-center ml-3">
                                            <span class="text-blue-600 font-bold">{{ appointment.patient.user.first_name|first }}{{ appointment.patient.user.last_name|first }}</span>
                                        </div>
                                    {% endif %}
                                    <div>
                                        <h3 class="font-bold text_dr text-sm">{{ appointment.patient.user.get_full_name }}</h3>
                                        <div class="flex items-center text-secondary text-xs mt-1">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-1 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                            </svg>
                                            <span>{{ appointment.time_slot.time|time:"H:i" }}</span>
                                        </div>
                                    </div>
                                </div>
                                <span class="px-3 py-1 rounded-lg text-xs font-medium {% if appointment.status == 'confirmed' %}bg-blue-50 text_dr{% elif appointment.status == 'completed' %}bg-green-50 text-success{% elif appointment.status == 'cancelled' %}bg-red-50 text-danger{% else %}bg-yellow-50 text-warning{% endif %}">
                                    {% if appointment.status == 'confirmed' %}
                                        تایید شده
                                    {% elif appointment.status == 'completed' %}
                                        تکمیل شده
                                    {% elif appointment.status == 'cancelled' %}
                                        لغو شده
                                    {% else %}
                                        در انتظار
                                    {% endif %}
                                </span>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="text-center py-8 bg-gray-50 rounded-10">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 mx-auto mb-3 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                        </svg>
                        <h3 class="text-lg font-bold text_dr mb-1">امروز نوبتی ندارید</h3>
                        <p class="text-secondary text-sm mb-4">فرصت مناسبی برای استراحت یا برنامه‌ریزی</p>
                        <a href="{% url 'doctors:doctor_availability' %}" class="text-sm text_dr hover:underline">
                            مدیریت زمان‌های حضور
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<script>
// Notification JavaScript functions
function markNotificationRead(notificationId) {
    fetch(`{% url 'doctors:mark_notification_read' 0 %}`.replace('0', notificationId), {
        method: 'POST',
        headers: {
            'X-CSRFToken': '{{ csrf_token }}',
            'Content-Type': 'application/json',
        },
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            const notificationItem = document.querySelector(`[data-notification-id="${notificationId}"]`);
            if (notificationItem) {
                notificationItem.classList.remove('bg-blue-50');
                const unreadDot = notificationItem.querySelector('.bg-blue-500');
                if (unreadDot) {
                    unreadDot.remove();
                }
                const readButton = notificationItem.querySelector('button[onclick*="markNotificationRead"]');
                if (readButton) {
                    readButton.remove();
                }
            }
            updateNotificationCount();
        }
    })
    .catch(error => {
        console.error('Error:', error);
    });
}

function markAllNotificationsRead() {
    fetch('{% url "doctors:mark_all_notifications_read" %}', {
        method: 'POST',
        headers: {
            'X-CSRFToken': '{{ csrf_token }}',
            'Content-Type': 'application/json',
        },
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // Remove all unread indicators
            document.querySelectorAll('.notification-item').forEach(item => {
                item.classList.remove('bg-blue-50');
                const unreadDot = item.querySelector('.bg-blue-500');
                if (unreadDot) {
                    unreadDot.remove();
                }
                const readButton = item.querySelector('button[onclick*="markNotificationRead"]');
                if (readButton) {
                    readButton.remove();
                }
            });

            // Hide the "mark all read" button
            const markAllButton = document.querySelector('button[onclick="markAllNotificationsRead()"]');
            if (markAllButton) {
                markAllButton.style.display = 'none';
            }

            updateNotificationCount();
        }
    })
    .catch(error => {
        console.error('Error:', error);
    });
}

function deleteNotification(notificationId) {
    if (confirm('آیا مطمئن هستید که می‌خواهید این اعلان را حذف کنید؟')) {
        fetch(`{% url 'doctors:delete_notification' 0 %}`.replace('0', notificationId), {
            method: 'POST',
            headers: {
                'X-CSRFToken': '{{ csrf_token }}',
                'Content-Type': 'application/json',
            },
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                const notificationItem = document.querySelector(`[data-notification-id="${notificationId}"]`);
                if (notificationItem) {
                    notificationItem.remove();
                }
                updateNotificationCount();

                // Check if there are no more notifications
                const remainingNotifications = document.querySelectorAll('.notification-item');
                if (remainingNotifications.length === 0) {
                    document.getElementById('notifications-container').innerHTML = `
                        <div class="text-center py-8 bg-gray-50 rounded-10">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 mx-auto mb-3 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 17h5l-5 5-5-5h5v-5a7.5 7.5 0 01-7.5-7.5"/>
                            </svg>
                            <h3 class="text-lg font-bold text_dr mb-1">اعلان جدیدی ندارید</h3>
                            <p class="text-secondary text-sm">اعلان‌های جدید در اینجا نمایش داده خواهند شد</p>
                        </div>
                    `;
                }
            }
        })
        .catch(error => {
            console.error('Error:', error);
        });
    }
}

function updateNotificationCount() {
    // This function can be used to update notification count in the header
    // Implementation depends on your header structure
}

// Auto-refresh notifications every 30 seconds
setInterval(function() {
    fetch('{% url "doctors:get_notifications" %}?limit=5')
        .then(response => response.json())
        .then(data => {
            if (data.notifications && data.notifications.length > 0) {
                // Update notification count badge if it exists
                const notificationBadge = document.querySelector('.notification-count');
                if (notificationBadge) {
                    notificationBadge.textContent = data.unread_count;
                    notificationBadge.style.display = data.unread_count > 0 ? 'inline' : 'none';
                }
            }
        })
        .catch(error => {
            console.error('Error fetching notifications:', error);
        });
}, 30000);
</script>
{% endblock %}